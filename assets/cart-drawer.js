class CartDrawer extends HTMLElement{constructor(){super(),this.addEventListener("keyup",e=>"Escape"===e.code&&this.close()),this.querySelector("#CartDrawer-Overlay").addEventListener("click",this.close.bind(this)),this.setHeaderCartIconAccessibility(),this.productRecommendation=document.querySelector("product-recommendation")}setHeaderCartIconAccessibility(){const t=document.querySelector("#cart-icon-bubble");t.setAttribute("role","button"),t.setAttribute("aria-haspopup","dialog"),t.addEventListener("click",e=>{e.preventDefault(),this.open(t)}),t.addEventListener("keydown",e=>{"SPACE"===e.code.toUpperCase()&&(e.preventDefault(),this.open(t))})}async getCartProduct(){var e=(await(await fetch("/cart.js")).json())["items"];return e}async productsRecommended(e){var e=await Promise.all(e.map(e=>this.fetchProductRecommendation(e.product_id,2,"related"))),t=new Map;for(const r of e.flat(1/0))t.set(r.id,r);return[...t.values()]}async fetchProductRecommendation(e,t,r){e=(await(await fetch(window.Shopify.routes.root+`recommendations/products.json?product_id=${e}&limit=${t}&intent=`+r)).json()).products;return e.length&&e}async getProductsRecommended(){return this.getCartProduct().then(e=>this.productsRecommended(e)).then(e=>e)}open(e){e&&this.setActiveElement(e);e=this.querySelector('[id^="Details-"] summary');e&&!e.hasAttribute("role")&&this.setSummaryAccessibility(e),setTimeout(()=>{this.classList.add("animate","active")}),this.addEventListener("transitionend",()=>{var e=this.classList.contains("is-empty")?this.querySelector(".drawer__inner-empty"):document.getElementById("CartDrawer"),t=this.querySelector(".drawer__inner")||this.querySelector(".drawer__close");trapFocus(e,t)},{once:!0}),this.hasScrollbar()&&(document.documentElement.classList.add("overflow-hidden"),document.body.style.overflowY="scroll",document.querySelector("sticky-header").style.overflowY="scroll")}removeRecommendations(){var e=Array.from(this.productRecommendation?.querySelectorAll("div"));e.length&&e.forEach(e=>e.remove())}renderRecommendations(t){if(t.length){this.removeRecommendations();for(let e=0;e<t.length;e++){var r,n,i,o,s,c,a=t[e];a&&({title:r,price:c,featured_image:n,url:i,variants:o}=a,s=document.createElement("div"),c=`$${c.toString().slice(0,c.toString().length-2)},`+c.toString().slice(-2),s.classList.add("recommendations-wrapper"),s.innerHTML=`<div class='img'>
						<img src=${n}>
					</div>
					<div class='content'>
						<a href=${i} class='title'>${r}</a>
						<p class='price'>${c}</p>
						<button data-id=${o[0].id}>
							<span>Add To Cart</span>
							<div class="loading-overlay__spinner hidden">
							<svg
								aria-hidden="true"
								focusable="false"
								role="presentation"
								class="spinner"
								viewBox="0 0 66 66"
								xmlns="http://www.w3.org/2000/svg"
							>
								<circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
							</svg>
						</div>
						</button>
					</div>`,a)&&this.productRecommendation?.appendChild(s)}var e=document.createElement("div");e.classList.add("close-drawer"),this.productRecommendation?.appendChild(e),this.productRecommendation?.recommendationAddCart(),document.querySelector("product-recommendation .close-drawer").addEventListener("click",()=>this.removeRecommendations())}}close(){this.classList.remove("active"),removeTrapFocus(this.activeElement),document.documentElement.classList.remove("overflow-hidden"),document.body.style.overflowY="auto",document.querySelector("sticky-header").style.overflowY="",this.removeRecommendations()}hasScrollbar(){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);return(window.innerHeight||document.documentElement.clientHeight)<e}setSummaryAccessibility(e){e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),e.nextElementSibling.getAttribute("id")&&e.setAttribute("aria-controls",e.nextElementSibling.id),e.addEventListener("click",e=>{e.currentTarget.setAttribute("aria-expanded",!e.currentTarget.closest("details").hasAttribute("open"))}),e.parentElement.addEventListener("keyup",onKeyUpEscape)}renderContents(t){this.querySelector(".drawer__inner").classList.contains("is-empty")&&this.querySelector(".drawer__inner").classList.remove("is-empty"),this.productId=t.id,this.getSectionsToRender().forEach(e=>{(e.selector?document.querySelector(e.selector):document.getElementById(e.id)).innerHTML=this.getSectionInnerHTML(t.sections[e.id],e.selector)}),setTimeout(()=>{this.querySelector("#CartDrawer-Overlay").addEventListener("click",this.close.bind(this)),this.open()})}getSectionInnerHTML(e,t=".shopify-section"){return(new DOMParser).parseFromString(e,"text/html").querySelector(t).innerHTML}getSectionsToRender(){return[{id:"cart-drawer",selector:"#CartDrawer"},{id:"cart-icon-bubble"}]}getSectionDOM(e,t=".shopify-section"){return(new DOMParser).parseFromString(e,"text/html").querySelector(t)}setActiveElement(e){this.activeElement=e}}customElements.define("cart-drawer",CartDrawer);class CartDrawerItems extends CartItems{getSectionsToRender(){return[{id:"CartDrawer",section:"cart-drawer",selector:".drawer__inner"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"}]}}customElements.define("cart-drawer-items",CartDrawerItems);